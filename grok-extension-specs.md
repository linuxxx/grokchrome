# Chrome 扩展程序规范：Grok 快速查询

## 1. 概述

该 Chrome 扩展程序旨在提供一种快速便捷的方式，使用户能够基于网页上选择的文本，在 Grok.com 上进行查询。当用户选择文本时，扩展程序将显示一个上下文按钮。点击此按钮后，扩展程序会将所选文本作为查询参数，导航到 Grok.com。理想情况下，Grok.com 的内容将显示在一个可调整大小、可最大化的小窗口（如弹出窗口或侧边栏）中，而不是打开一个新标签页。

## 2. 用户交互

### 2.1 文本选择与按钮显示
*   当用户在任何网页上选择（高亮）一段文本时，一个小的、非侵入式的按钮（以下称为“Grok 查询按钮”）应出现在所选文本的右侧或下方。
*   按钮的显示应有轻微延迟（例如 200-300 毫秒），以避免在用户仍在选择文本时过早出现。
*   如果用户取消选择文本或在页面其他位置点击，Grok 查询按钮应自动消失。
*   如果选择的文本过短（例如少于3个字符），则不显示按钮，以避免不必要的干扰。

### 2.2 点击 Grok 查询按钮
*   当用户点击 Grok 查询按钮时：
    *   扩展程序应获取当前选择的文本。
    *   扩展程序应构造一个指向 `https://grok.com/` 的 URL，并将所选文本作为查询参数（具体参数名需确认，假设为 `q`，例如 `https://grok.com/?q=YOUR_SELECTED_TEXT`）。
    *   扩展程序应打开一个新的小窗口（首选方案）或一个侧边栏，加载构造好的 URL。

### 2.3 Grok 显示窗口交互
*   **首选方案：小窗口/弹出窗口**
    *   该窗口应默认以一个较小的、预设的尺寸打开（例如，宽 400px，高 600px），位置可以在屏幕右下角或浏览器窗口的右侧。
    *   窗口应包含 Grok.com 的网页内容。
    *   窗口应有清晰的控件允许用户：
        *   **拖动**：用户可以按住窗口标题栏（如果设计有）或特定区域拖动窗口到屏幕不同位置。
        *   **调整大小**：用户可以拖动窗口边缘或角落来调整其大小。
        *   **最大化/恢复**：一个按钮允许用户将窗口最大化到占据大部分浏览器视口或恢复到先前大小。
        *   **关闭**：一个按钮允许用户关闭该小窗口。
    *   当小窗口打开时，原始网页的交互不应被完全阻塞，用户仍可滚动或与原始页面交互（如果窗口未覆盖关键区域）。
*   **备选方案：侧边栏**
    *   侧边栏应从浏览器窗口的右侧滑出。
    *   侧边栏宽度可固定或可由用户拖动调整。
    *   侧边栏应包含 Grok.com 的网页内容。
    *   应有明确的关闭按钮。
*   **通用行为**：
    *   如果用户在 Grok 显示窗口打开时，在原始页面上选择了新的文本并再次点击 Grok 查询按钮，现有的 Grok 显示窗口应刷新并加载新的查询结果。不应打开新的小窗口/侧边栏。
    *   如果 Grok 显示窗口已关闭，再次点击 Grok 查询按钮将重新打开它。

### 2.4 扩展程序图标交互 (可选)
*   扩展程序在浏览器工具栏上可能有一个图标。
*   点击该图标可能会打开一个小的弹出菜单，包含：
    *   设置选项（例如，默认窗口大小、是否启用等）。
    *   关于信息。
    *   一个手动输入查询文本框并跳转到 Grok 的选项（作为文本选择的补充）。

## 3. UI 元素

### 3.1 Grok 查询按钮
*   **外观**：一个小巧、简洁的图标按钮（例如，Grok 的 logo 或一个放大镜图标加上 "Grok" 字样）。
*   **位置**：紧邻所选文本的右侧或右下方。应智能定位以避免遮挡重要内容或超出视口。
*   **状态**：
    *   默认状态。
    *   鼠标悬停状态（例如，轻微放大或改变背景色以提供反馈）。
*   **工具提示 (Tooltip)**：鼠标悬停在按钮上时，显示 "使用 Grok 查询..." 或类似提示。

### 3.2 Grok 显示窗口 (小窗口/弹出窗口方案)
*   **框架**：一个独立的、可拖动、可调整大小的窗口。
*   **标题栏 (可选)**：如果设计为独立窗口，可能包含窗口标题（例如 "Grok 查询"）和最大化/关闭按钮。
*   **内容区域**：嵌入 `<iframe>` 用于加载和显示 `https://grok.com/`。
*   **控件**：
    *   最大化/恢复按钮。
    *   关闭按钮。
    *   调整大小的句柄（窗口边缘）。

### 3.3 Grok 显示区域 (侧边栏方案)
*   **面板**：从浏览器右侧滑出的面板。
*   **标题栏 (可选)**：包含标题和关闭按钮。
*   **内容区域**：嵌入 `<iframe>` 用于加载和显示 `https://grok.com/`。
*   **调整大小句柄 (可选)**：在侧边栏的左边缘，允许用户调整宽度。

## 4. 与 Grok.com 的交互

*   扩展程序通过构造 URL 并将所选文本作为查询参数来与 Grok.com 交互。
    *   URL 格式: `https://grok.com/?q=<URL编码后的所选文本>` (假设查询参数为 `q`，需要确认 Grok.com 使用的实际参数)。
*   Grok.com 的内容将通过 `<iframe>` 加载到扩展程序创建的小窗口或侧边栏中。
*   **重要考虑**：
    *   **CSP (Content Security Policy)**：Grok.com 的 CSP 设置可能会阻止其在 `<iframe>` 中被加载。这需要测试。如果存在此问题，可能需要寻找替代方案，例如打开一个新标签页（作为后备方案）或使用更受限的弹出窗口 API（如果允许）。
    *   **X-Frame-Options**: 类似的，`X-Frame-Options` HTTP 头也可能阻止 iframe 加载。
    *   如果无法在 iframe 中加载，则必须回退到在新标签页中打开链接：`window.open('https://grok.com/?q=' + encodedText, '_blank')`。此回退机制应在规范中明确。

## 5. 错误处理和边缘情况

*   **无文本选择**：不应显示 Grok 查询按钮。
*   **选择文本过短**：不应显示 Grok 查询按钮。
*   **网络错误**：如果在小窗口/侧边栏中加载 Grok.com 失败（例如，无网络连接），应在 `<iframe>` 区域显示一个友好的错误消息（例如，“无法连接到 Grok.com，请检查您的网络连接”）。
*   **Grok.com iframe 加载限制**：
    *   如果由于 CSP 或 `X-Frame-Options` 导致无法在 iframe 中加载 Grok.com，扩展程序应检测到此情况（如果可能）或提供一个明确的设置选项，让用户选择在新标签页中打开查询结果。
    *   或者，默认行为在检测到 iframe 失败时自动切换到在新标签页打开。
*   **特殊字符处理**：所选文本在作为 URL 参数传递之前必须进行正确的 URL 编码 (e.g., using `encodeURIComponent()`)。

## 6. 权限 (manifest.json)

*   `activeTab`：允许在用户当前活动的标签页上运行内容脚本。
*   `scripting`：用于动态注入内容脚本和执行脚本。
*   `storage`：(可选) 如果需要存储用户偏好设置（如窗口大小、启用/禁用状态）。
*   `contextMenus`：(可选) 如果决定通过右键菜单提供此功能作为按钮的补充或替代。
*   `declarativeNetRequest` 或 `webRequest` (如果需要修改请求头以尝试解决 iframe 加载问题，但通常不推荐用于此目的，且权限较高)。

## 7. 潜在的未来增强功能

*   用户可自定义按钮外观和位置。
*   用户可配置默认的小窗口/侧边栏大小和位置。
*   支持将查询历史记录（仅限查询文本，非结果）保存在本地。
*   提供选项以选择是在小窗口、侧边栏还是新标签页中打开。
*   支持快捷键激活查询（例如，选择文本后按特定组合键）。
*   集成其他搜索引擎或 AI 服务作为选项。